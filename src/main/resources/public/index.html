<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>File Service</title>
    <style>
        body { font-family: system-ui, sans-serif; max-width: 900px; margin: 24px auto; padding: 0 12px; }
        .row { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
        table { width: 100%; border-collapse: collapse; margin-top: 16px; }
        th, td { border-bottom: 1px solid #ddd; padding: 8px; text-align: left; }
        button { cursor: pointer; }
        code { background: #f6f6f6; padding: 2px 6px; border-radius: 6px; }
    </style>
</head>
<body>
<h1>File Service</h1>

<div class="row">
    <input id="file" type="file" />
    <button id="upload">Upload</button>
    <button id="refresh">Refresh list</button>
</div>

<div id="msg" style="margin-top:12px;"></div>

<table>
    <thead>
    <tr><th>Name</th><th>Size</th><th>Actions</th></tr>
    </thead>
    <tbody id="tbody"></tbody>
</table>

<script>
    const msg = (t) => document.getElementById("msg").textContent = t;

    async function refresh() {
        const res = await fetch("/api/plugins");
        const files = await res.json();
        const tbody = document.getElementById("tbody");
        tbody.innerHTML = "";
        for (const f of files) {
            const tr = document.createElement("tr");

            const tdName = document.createElement("td");
            const a = document.createElement("a");
            a.href = "/api/plugins/" + encodeURIComponent(f);
            a.textContent = f;
            tdName.appendChild(a);

            const tdSize = document.createElement("td");
            tdSize.textContent = f;

            const tdAct = document.createElement("td");
            const del = document.createElement("button");
            del.textContent = "Delete";
            del.onclick = async () => {
                const r = await fetch("/api/plugins/" + encodeURIComponent(f), { method: "DELETE" });
                if (r.status === 204) msg("Deleted " + f);
                else msg("Delete failed: " + (await r.text()));
                refresh();
            };
            tdAct.appendChild(del);

            tr.appendChild(tdName);
            tr.appendChild(tdSize);
            tr.appendChild(tdAct);
            tbody.appendChild(tr);
        }
    }

    document.getElementById("refresh").onclick = refresh;

    document.getElementById("upload").onclick = async () => {
        const input = document.getElementById("file");
        if (!input.files || input.files.length === 0) { msg("Choose a file first."); return; }
        const fd = new FormData();
        fd.append("file", input.files[0]);

        const r = await fetch("/api/plugins", { method: "POST", body: fd });
        if (r.ok) msg("Uploaded.");
        else msg("Upload failed: " + (await r.text()));
        input.value = "";
        refresh();
    };

    refresh();
</script>
</body>
</html>